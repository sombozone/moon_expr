///|
test "test char" {
  let source = "a ä¸­æ–‡ _123 $123 "
  assert_eq(source.get_char(2), Some('ä¸­'))
}

///|
test "character indexing with unicode" {
  let source = "a ä¸­æ–‡ _123 $123 "

  // éªŒè¯å„ä¸ªä½ç½®çš„å­—ç¬¦
  assert_eq(source.get_char(0), Some('a'))
  assert_eq(source.get_char(1), Some(' '))
  assert_eq(source.get_char(2), Some('ä¸­'))
  assert_eq(source.get_char(3), Some('æ–‡'))
  assert_eq(source.get_char(4), Some(' '))
  assert_eq(source.get_char(5), Some('_'))
  assert_eq(source.get_char(6), Some('1'))
  assert_eq(source.get_char(7), Some('2'))
  assert_eq(source.get_char(8), Some('3'))
  assert_eq(source.get_char(9), Some(' '))
  assert_eq(source.get_char(10), Some('$'))
  assert_eq(source.get_char(11), Some('1'))
  assert_eq(source.get_char(12), Some('2'))
  assert_eq(source.get_char(13), Some('3'))
  assert_eq(source.get_char(14), Some(' '))

  // éªŒè¯å­—ç¬¦ä¸²é•¿åº¦ï¼ˆæŒ‰å­—ç¬¦è®¡æ•°ï¼‰
  assert_eq(source.length(), 15)

  // éªŒè¯è¶…å‡ºèŒƒå›´çš„ç´¢å¼•
  assert_eq(source.get_char(15), None)
  assert_eq(source.get_char(-1), None)
}

///|
test "emoji character indexing" {
  let source_with_emoji = "HelloğŸŒWorld"

  // éªŒè¯emojiå­—ç¬¦çš„ä½ç½®ï¼ˆæ³¨æ„ï¼šemojiåœ¨MoonBitä¸­å ç”¨2ä¸ªå­—ç¬¦ä½ç½®ï¼‰
  assert_eq(source_with_emoji.get_char(0), Some('H'))
  assert_eq(source_with_emoji.get_char(1), Some('e'))
  assert_eq(source_with_emoji.get_char(2), Some('l'))
  assert_eq(source_with_emoji.get_char(3), Some('l'))
  assert_eq(source_with_emoji.get_char(4), Some('o'))
  assert_eq(source_with_emoji.get_char(5), Some('ğŸŒ')) // emojiåœ¨ä½ç½®5
  assert_eq(source_with_emoji.get_char(6), None) // ä½ç½®6ä¸ºNoneï¼ˆemojiå ç”¨çš„ç¬¬äºŒä¸ªä½ç½®ï¼‰
  assert_eq(source_with_emoji.get_char(7), Some('W'))
  assert_eq(source_with_emoji.get_char(8), Some('o'))
  assert_eq(source_with_emoji.get_char(9), Some('r'))
  assert_eq(source_with_emoji.get_char(10), Some('l'))
  assert_eq(source_with_emoji.get_char(11), Some('d'))
  assert_eq(source_with_emoji.length(), 12) // æ€»é•¿åº¦åŒ…å«emojiå ç”¨çš„2ä¸ªä½ç½®
}

///|
test "mixed unicode characters" {
  let mixed = "aÎ±ä¸­ğŸŒÃ©_â¤ï¸"
  println(mixed.iter().count())

  // æ³¨æ„ï¼šemojiå ç”¨2ä¸ªå­—ç¬¦ä½ç½®ï¼Œå…¶ä»–Unicodeå­—ç¬¦å ç”¨1ä¸ª
  assert_eq(mixed.get_char(0), Some('a')) // ASCII
  assert_eq(mixed.get_char(1), Some('Î±')) // å¸Œè…Šå­—æ¯
  assert_eq(mixed.get_char(2), Some('ä¸­')) // ä¸­æ–‡å­—ç¬¦
  assert_eq(mixed.get_char(3), Some('ğŸŒ')) // emojiåœ¨ä½ç½®3
  // assert_eq(mixed.get_char(4), None) // emojiå ç”¨çš„ç¬¬äºŒä¸ªä½ç½®
  assert_eq(mixed.get_char(5), Some('Ã©')) // å¸¦é‡éŸ³å­—æ¯
  assert_eq(mixed.get_char(6), Some('_')) // ä¸‹åˆ’çº¿
  assert_eq(mixed[:][7:], "â¤ï¸") // ä¸‹åˆ’çº¿
  assert_eq(mixed.iter().count()-1, 7) // æ€»é•¿åº¦åŒ…å«emojiå ç”¨çš„é¢å¤–ä½ç½®
}


test "emoji length and indexing" {
  let s = "ağŸŒb"
  // å­—ç¬¦é•¿åº¦ï¼ˆç ç‚¹æ•°ï¼‰ï¼š3
  assert_eq(s.length(), 4)
  // å­—èŠ‚é•¿åº¦ï¼š1 + 4 + 1 = 6
  assert_eq(s.to_bytes().length(), 8)

  // ç´¢å¼•ï¼š0:'a'  1:'ğŸŒ'  2:'b'
  assert_eq(s.get_char(1), Some('ğŸŒ'))

  // å•ä¸ª emoji çš„å­—èŠ‚é•¿åº¦
  let emoji_bytes = @encoding/utf8.encode('ğŸŒ'.to_string()).length()
  assert_eq(emoji_bytes, 4)
}

test "emoji with variation selectors" {
  // æ•°å­—1 + å˜ä½“é€‰æ‹©ç¬¦-16 = emojiæ•°å­—1
  let variation_char = "â¤ï¸"

  assert_eq(variation_char.get_char(1).unwrap() == '\u{fe0f}', true)
  
}

test "contains_any" {
  // æ•°å­—1 + å˜ä½“é€‰æ‹©ç¬¦-16 = emojiæ•°å­—1
  let s1 = "abc"
    // ä¸åŒ…å« 'x', 'y', 'z' ä»»ä½•ä¸€ä¸ª
    assert_true(s1.contains_any(chars= "d".to_string_view()))
  
} 