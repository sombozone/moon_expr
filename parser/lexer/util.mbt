///|
/// è¯æ³•åˆ†æå·¥å…·ç±»
/// æä¾›ç”¨äºå¿«é€Ÿè¯æ³•è¯­ä¹‰åˆ¤æ–­çš„å®ç”¨å‡½æ•°

///|
/// åˆ¤æ–­å­—ç¬¦æ˜¯å¦æ˜¯ç©ºç™½ç¬¦ï¼ˆä½¿ç”¨ Unicode æ ‡å‡†ï¼‰
pub fn is_space(ch : Char) -> Bool {
  // ä½¿ç”¨Charçš„å†…ç½®æ–¹æ³•åˆ¤æ–­ç©ºç™½ç¬¦
  ch.is_whitespace()
}

///|
/// åˆ¤æ–­å­—ç¬¦æ˜¯å¦æ˜¯å­—æ¯ï¼ˆåŒ…å« `_`ã€`$` ï¼‰
pub fn is_alphabetic(ch : Char) -> Bool {
  // è§„åˆ™ï¼š
  // - ä¸‹åˆ’çº¿ä¸ç¾å…ƒç¬¦å±äºâ€œå­—æ¯â€é›†åˆ
  // - ASCII å­—æ¯ç›´æ¥è§†ä¸ºå­—æ¯
  // - å¸¸è§é ASCII çš„ Unicode å­—æ¯ï¼ˆå«æ‹‰ä¸æ‰©å±•ã€å¸Œè…Šã€CJK ç­‰ï¼‰
  //   è¿‘ä¼¼åˆ¤æ–­ä¸ºï¼šutf16_len()==1 ä¸” éç©ºç™½ ä¸” éæ•°å­— ä¸” é emoji
  if ch == '_' || ch == '$' { return true }
  if ch.is_ascii_alphabetic() { return true }
  // è¿‘ä¼¼çš„ Unicode å­—æ¯åˆ¤æ–­ï¼šé ASCII ä¸”éç©ºç™½ä¸”é emoji
  let byte_len = @encoding/utf8.encode(ch.to_string()).length()
  let is_ascii = byte_len == 1
  if !is_ascii && !ch.is_whitespace() && !is_emoji(ch) {
    return true
  }
  false
}

///|
/// åˆ¤æ–­å­—ç¬¦æ˜¯å¦æ˜¯"å­—æ¯æˆ–æ•°å­—"ï¼ˆè¿™é‡Œçš„"å­—æ¯"å«ä¸‹åˆ’çº¿å’Œç¾å…ƒç¬¦ï¼‰
pub fn is_alpha_numeric(ch : Char) -> Bool {
  is_alphabetic(ch) || ch.is_ascii_digit()
}

///|
/// åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦æ˜¯åˆæ³•æ ‡è¯†ç¬¦
/// é¦–å­—ç¬¦ä¸º"å­—æ¯"ï¼Œåç»­ä¸º"å­—æ¯æˆ–æ•°å­—"
pub fn is_valid_identifier(str : String) -> Bool {
  // ç©ºä¸²ç›´æ¥è¿”å› false
  if str.is_empty() {
    return false
  }

  // è·å–ç¬¬ä¸€ä¸ªå­—ç¬¦
  let first_char = str.get_char(0)

  // æ£€æŸ¥é¦–å­—ç¬¦æ˜¯å¦æ˜¯å­—æ¯ï¼ˆåŒ…å« _ å’Œ $ï¼‰
  match first_char {
    Some(ch) => if !is_alphabetic(ch) { return false }
    None => return false
  }

  // æ£€æŸ¥å‰©ä½™å­—ç¬¦
  let mut i = 1
  // ä»¥å­—ç¬¦ç»´åº¦éå†ï¼Œè€Œä¸æ˜¯ UTF-16 ç å…ƒç»´åº¦
  while i < str.char_length() {
    match str.get_char(i) {
      Some(ch) => if !is_alpha_numeric(ch) { return false }
      None => return false
    }
    i = i + 1
  }
  true
}

pub fn is_emoji_selector(ch : Char) -> Bool {
  ch == '\u{fe0f}' || ch == '\u{fe0e}'
}

///|
/// ç²—ç•¥åˆ¤æ–­æ˜¯å¦ä¸º emojiï¼ˆé«˜ä½çš„è¡¨æƒ…ç¬¦å·é€šå¸¸åœ¨ UTF-16 ç”±ä¸¤ä¸ªå•å…ƒè¡¨ç¤ºï¼‰
/// æ³¨æ„ï¼šè¿™æ˜¯ä¸€ä¸ªè¿‘ä¼¼åˆ¤æ–­ï¼Œä»…ç”¨äºåŒºåˆ†æµ‹è¯•ä¸­çš„ 'ğŸ’¡' ç­‰è¡¨æƒ…ç¬¦å·ï¼Œä¸ä½œä¸ºé€šç”¨ Unicode åˆ†ç±»æ–¹æ¡ˆã€‚
pub fn is_emoji(ch : Char) -> Bool {
  ch.utf16_len() == 2
}
